<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blood Bank Management System</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

:root {
    --primary-red: #dc2626;
    --primary-red-dark: #b91c1c;
    --secondary-red: #ef4444;
    --accent-red: #fee2e2;
    --dark-red: #7f1d1d;
    --light-red: #fef2f2;
    
    --primary-bg: #0f172a;
    --secondary-bg: #1e293b;
    --card-bg: rgba(255, 255, 255, 0.95);
    --glass-bg: rgba(255, 255, 255, 0.1);
    
    --text-primary: #0f172a;
    --text-secondary: #64748b;
    --text-light: #94a3b8;
    
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
    min-height: 100vh;
    color: var(--text-primary);
    overflow-x: hidden;
    position: relative;
}

/* Enhanced Background Animations */
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(circle at 20% 80%, rgba(220, 38, 38, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 80% 20%, rgba(239, 68, 68, 0.15) 0%, transparent 40%),
        radial-gradient(circle at 50% 50%, rgba(127, 29, 29, 0.1) 0%, transparent 50%);
    z-index: -1;
    animation: backgroundPulse 8s ease-in-out infinite, gradientShift 20s ease-in-out infinite;
}

@keyframes backgroundPulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.7; transform: scale(1.02); }
}

@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* Enhanced Floating Blood Drops with Mouse Interaction */
.blood-drops {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -1;
}

.blood-drop {
    position: absolute;
    width: 8px;
    height: 8px;
    background: var(--primary-red);
    border-radius: 50% 50% 50% 0;
    transform: rotate(-45deg);
    opacity: 0.15;
    animation: float 12s infinite ease-in-out;
    transition: transform 0.3s ease, opacity 0.3s ease;
}

.blood-drop:hover {
    transform: scale(1.5) rotate(-45deg);
    opacity: 0.3;
    animation: pulseDrop 1s ease-in-out infinite;
}

@keyframes pulseDrop {
    0%, 100% { transform: scale(1.5) rotate(-45deg); }
    50% { transform: scale(1.8) rotate(-45deg); }
}

@keyframes float {
    from {
        transform: translateY(-100vh) rotate(-45deg) translateX(-20px);
        opacity: 0;
    }
    10% {
        opacity: 0.15;
    }
    90% {
        opacity: 0.15;
    }
    to {
        transform: translateY(100vh) rotate(-45deg) translateX(20px);
        opacity: 0;
    }
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
    position: relative;
    z-index: 1;
}

.header {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%);
    backdrop-filter: blur(20px);
    border-radius: 24px;
    padding: 40px 30px;
    margin-bottom: 40px;
    text-align: center;
    box-shadow: var(--shadow-xl);
    border: 1px solid rgba(255, 255, 255, 0.2);
    position: relative;
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.header:hover {
    transform: translateY(-8px);
    box-shadow: 0 25px 50px -12px rgba(220, 38, 38, 0.3);
}

.header::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(220, 38, 38, 0.2), transparent);
    animation: shimmer 2.5s infinite;
}

@keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
}

.header h1 {
    color: var(--primary-red);
    font-size: 3.5em;
    font-weight: 800;
    margin-bottom: 15px;
    text-shadow: 2px 2px 8px rgba(220, 38, 38, 0.2);
    position: relative;
    z-index: 2;
    transition: transform 0.3s ease;
}

.header h1:hover {
    transform: scale(1.05);
}

.header h1::after {
    content: 'ðŸ’‰';
    margin-left: 15px;
    animation: bounce 2s infinite;
    display: inline-block;
    transition: transform 0.3s ease;
}

.header h1:hover::after {
    transform: rotate(360deg);
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-10px); }
    60% { transform: translateY(-5px); }
}

.header p {
    color: var(--text-secondary);
    font-size: 1.3em;
    font-weight: 500;
    position: relative;
    z-index: 2;
    transition: color 0.3s ease;
}

.header p:hover {
    color: var(--primary-red);
}

.nav-tabs {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-bottom: 40px;
    flex-wrap: wrap;
    padding: 20px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: transform 0.3s ease;
}

.nav-tabs:hover {
    transform: translateY(-4px);
}

.nav-tab {
    background: rgba(255, 255, 255, 0.9);
    border: none;
    padding: 16px 32px;
    border-radius: 30px;
    cursor: pointer;
    font-size: 1.1em;
    font-weight: 600;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: var(--shadow-md);
    position: relative;
    overflow: hidden;
    color: var(--text-primary);
}

.nav-tab::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--primary-red), var(--secondary-red));
    transition: left 0.4s ease;
    z-index: -1;
}

.nav-tab:hover::before,
.nav-tab.active::before {
    left: 0;
}

.nav-tab:hover,
.nav-tab.active {
    color: white;
    transform: translateY(-4px) scale(1.05);
    box-shadow: var(--shadow-xl);
}

.nav-tab:active {
    transform: translateY(-2px) scale(1.02);
}

.tab-content {
    display: none;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 24px;
    padding: 40px;
    box-shadow: var(--shadow-xl);
    border: 1px solid rgba(255, 255, 255, 0.2);
    position: relative;
    overflow: hidden;
    transition: transform 0.3s ease;
}

.tab-content:hover {
    transform: translateY(-8px);
}

.tab-content::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(135deg, var(--primary-red), var(--secondary-red));
    border-radius: 24px 24px 0 0;
    transition: height 0.3s ease;
}

.tab-content:hover::before {
    height: 8px;
}

.tab-content.active {
    display: block;
    animation: slideIn 0.5s ease-out;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.tab-content h2 {
    color: var(--primary-red);
    font-size: 2.5em;
    font-weight: 700;
    margin-bottom: 30px;
    text-align: center;
    position: relative;
    transition: transform 0.3s ease, color 0.3s ease;
}

.tab-content h2:hover {
    transform: scale(1.05);
    color: var(--primary-red-dark);
}

.tab-content h2::after {
    content: '';
    position: absolute;
    bottom: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 4px;
    background: linear-gradient(135deg, var(--primary-red), var(--secondary-red));
    border-radius: 2px;
    transition: width 0.3s ease;
}

.tab-content h2:hover::after {
    width: 100px;
}

.form-group {
    margin-bottom: 25px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--text-primary);
    font-size: 1.1em;
    transition: color 0.3s ease;
}

.form-group label:hover {
    color: var(--primary-red);
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 16px 20px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 1.1em;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--primary-red);
    box-shadow: 0 0 0 4px rgba(220, 38, 38, 0.1);
    transform: translateY(-2px) scale(1.02);
}

.form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
}

.btn {
    background: linear-gradient(135deg, var(--primary-red), var(--secondary-red));
    color: white;
    border: none;
    padding: 16px 40px;
    border-radius: 30px;
    cursor: pointer;
    font-size: 1.1em;
    font-weight: 600;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: var(--shadow-lg);
    position: relative;
    overflow: hidden;
}

.btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: width 0.4s ease, height 0.4s ease;
}

.btn:hover::before {
    width: 300px;
    height: 300px;
}

.btn:hover {
    transform: translateY(-4px) scale(1.05);
    box-shadow: var(--shadow-xl);
}

.btn:active {
    transform: translateY(-2px) scale(1.02);
}

.btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    transform: none;
}

.btn-secondary {
    background: linear-gradient(135deg, #64748b, #94a3b8);
}

.cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 25px;
    margin-top: 30px;
}

.card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 20px;
    padding: 30px;
    box-shadow: var(--shadow-lg);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    position: relative;
    overflow: hidden;
}

.card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 6px;
    background: linear-gradient(135deg, var(--primary-red), var(--secondary-red));
    transform: scaleX(0);
    transition: transform 0.4s ease;
}

.card:hover::before {
    transform: scaleX(1);
}

.card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: var(--shadow-xl);
    background: rgba(255, 255, 255, 1);
}

.card h3 {
    color: var(--primary-red);
    margin-bottom: 15px;
    font-size: 1.4em;
    font-weight: 700;
    transition: transform 0.3s ease;
}

.card h3:hover {
    transform: translateX(5px);
}

.blood-type {
    display: inline-block;
    background: linear-gradient(135deg, var(--primary-red), var(--secondary-red));
    color: white;
    padding: 8px 20px;
    border-radius: 25px;
    font-weight: 700;
    margin-bottom: 15px;
    font-size: 1.1em;
    box-shadow: var(--shadow-md);
    animation: pulse 2s infinite;
    transition: transform 0.3s ease;
}

.blood-type:hover {
    transform: scale(1.1);
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.status {
    display: inline-block;
    padding: 8px 20px;
    border-radius: 25px;
    font-weight: 700;
    margin-bottom: 15px;
    font-size: 0.95em;
    box-shadow: var(--shadow-sm);
    transition: transform 0.3s ease;
}

.status:hover {
    transform: scale(1.1);
}

.status.available {
    background: linear-gradient(135deg, var(--success), #10b981);
    color: white;
}

.status.critical {
    background: linear-gradient(135deg, var(--warning), #f59e0b);
    color: white;
}

.status.out-of-stock {
    background: linear-gradient(135deg, var(--danger), #ef4444);
    color: white;
}

.status.low {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    color: white;
}

.status.medium {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    color: white;
}

.status.high {
    background: linear-gradient(135deg, #f59e0b, #d97706);
    color: white;
}

.status.pending {
    background: linear-gradient(135deg, #6b7280, #4b5563);
    color: white;
}

.status.approved {
    background: linear-gradient(135deg, var(--success), #10b981);
    color: white;
}

.status.rejected {
    background: linear-gradient(135deg, var(--danger), #ef4444);
    color: white;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 25px;
    margin-top: 30px;
}

.stat-card {
    background: linear-gradient(135deg, var(--primary-red), var(--secondary-red));
    color: white;
    padding: 35px 25px;
    border-radius: 20px;
    text-align: center;
    box-shadow: var(--shadow-xl);
    transition: all 0.4s ease;
    position: relative;
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.15), transparent);
    transform: rotate(45deg);
    animation: sparkle 3s infinite;
}

.stat-card:hover::before {
    animation: sparkleFast 1.5s infinite;
}

@keyframes sparkle {
    0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
    100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
}

@keyframes sparkleFast {
    0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
    100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
}

.stat-card:hover {
    transform: translateY(-8px) scale(1.05);
    box-shadow: 0 25px 50px -12px rgba(220, 38, 38, 0.4);
}

.stat-card h3 {
    font-size: 3em;
    margin-bottom: 10px;
    font-weight: 800;
    position: relative;
    z-index: 2;
    transition: transform 0.3s ease;
}

.stat-card h3:hover {
    transform: scale(1.1);
}

.stat-card p {
    font-size: 1.2em;
    font-weight: 600;
    position: relative;
    z-index: 2;
    transition: transform 0.3s ease;
}

.stat-card p:hover {
    transform: translateY(-2px);
}

.alert {
    padding: 20px 25px;
    margin-bottom: 25px;
    border-radius: 15px;
    font-weight: 600;
    font-size: 1.1em;
    box-shadow: var(--shadow-md);
    border-left: 6px solid;
    animation: slideInAlert 0.5s ease-out;
    transition: transform 0.3s ease;
}

.alert:hover {
    transform: translateX(5px);
}

@keyframes slideInAlert {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes slideOutAlert {
    from {
        opacity: 1;
        transform: translateX(0);
    }
    to {
        opacity: 0;
        transform: translateX(-20px);
    }
}

.alert.success {
    background: linear-gradient(135deg, #d1fae5, #a7f3d0);
    color: #065f46;
    border-left-color: var(--success);
}

.alert.error {
    background: linear-gradient(135deg, #fef2f2, #fecaca);
    color: #7f1d1d;
    border-left-color: var(--danger);
}

.loading {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-secondary);
    font-size: 1.2em;
}

.loading::before {
    content: '';
    display: inline-block;
    width: 40px;
    height: 40px;
    border: 4px solid rgba(220, 38, 38, 0.1);
    border-left-color: var(--primary-red);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 15px;
    transition: transform 0.3s ease;
}

.loading:hover::before {
    transform: scale(1.2);
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

@media (max-width: 768px) {
    .container {
        padding: 15px;
    }

    .header {
        padding: 30px 20px;
    }

    .header h1 {
        font-size: 2.5em;
    }

    .nav-tabs {
        flex-direction: column;
        align-items: center;
        gap: 10px;
    }

    .nav-tab {
        width: 100%;
        max-width: 300px;
    }

    .form-row {
        grid-template-columns: 1fr;
    }

    .cards-container {
        grid-template-columns: 1fr;
    }

    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .tab-content {
        padding: 25px 20px;
    }
}

@media (max-width: 480px) {
    .stats-grid {
        grid-template-columns: 1fr;
    }

    .stat-card h3 {
        font-size: 2.5em;
    }
}

::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, var(--primary-red), var(--secondary-red));
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, var(--primary-red-dark), var(--primary-red));
}

.form-group input:valid {
    border-color: var(--success);
}

.form-group input:invalid:not(:placeholder-shown) {
    border-color: var(--danger);
}

@media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
        animation: none !important;
        transition: none !important;
    }
}

/* New Particle Animation for Interactive Background */
.particle-system {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -2;
}

.particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background: var(--secondary-red);
    border-radius: 50%;
    opacity: 0.3;
    animation: particleFloat 10s infinite ease-in-out;
}

.particle:hover {
    transform: scale(1.5);
    opacity: 0.5;
    animation: particlePulse 0.5s ease-in-out infinite;
}

@keyframes particleFloat {
    0% { transform: translateY(0) translateX(0); opacity: 0.3; }
    50% { transform: translateY(-20px) translateX(10px); opacity: 0.5; }
    100% { transform: translateY(0) translateX(0); opacity: 0.3; }
}

@keyframes particlePulse {
    0%, 100% { transform: scale(1.5); }
    50% { transform: scale(2); }
}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ©¸ Blood Bank Management System</h1>
            <p>Saving Lives Through Efficient Blood Management</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">Dashboard</button>
            <button class="nav-tab" onclick="showTab('donors')">Donors</button>
            <button class="nav-tab" onclick="showTab('recipients')">Recipients</button>
            <button class="nav-tab" onclick="showTab('inventory')">Inventory</button>
            <button class="nav-tab" onclick="showTab('requests')">Requests</button>
        </div>

        <div id="dashboard" class="tab-content active">
            <h2>Dashboard</h2>
            <div id="dashboardStats" class="stats-grid">
                <div class="stat-card">
                    <h3 id="totalDonors">0</h3>
                    <p>Total Donors</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalRecipients">0</h3>
                    <p>Total Recipients</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalUnits">0</h3>
                    <p>Blood Units Available</p>
                </div>
                <div class="stat-card">
                    <h3 id="pendingRequests">0</h3>
                    <p>Pending Requests</p>
                </div>
            </div>
            <div id="bloodTypeStats" class="cards-container">
                <!-- Blood type statistics will be populated here -->
            </div>
        </div>

        <div id="donors" class="tab-content">
            <h2>Donor Management</h2>
            <div id="donorAlert"></div>
            <form id="donorForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="donorName">Full Name</label>
                        <input type="text" id="donorName" required>
                    </div>
                    <div class="form-group">
                        <label for="donorAge">Age</label>
                        <input type="number" id="donorAge" min="18" max="65" required>
                    </div>
                    <div class="form-group">
                        <label for="donorBloodType">Blood Type</label>
                        <select id="donorBloodType" required>
                            <option value="">Select Blood Type</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="donorPhone">Phone Number</label>
                        <input type="tel" id="donorPhone" required>
                    </div>
                    <div class="form-group">
                        <label for="donorEmail">Email</label>
                        <input type="email" id="donorEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="donorAddress">Address</label>
                        <textarea id="donorAddress" rows="3" required></textarea>
                    </div>
                </div>
                <button type="submit" class="btn">Register Donor</button>
            </form>
            <div id="donorsList" class="cards-container">
                <!-- Donors will be populated here -->
            </div>
        </div>

        <div id="recipients" class="tab-content">
            <h2>Recipient Management</h2>
            <div id="recipientAlert"></div>
            <form id="recipientForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="recipientName">Full Name</label>
                        <input type="text" id="recipientName" required>
                    </div>
                    <div class="form-group">
                        <label for="recipientAge">Age</label>
                        <input type="number" id="recipientAge" min="1" max="120" required>
                    </div>
                    <div class="form-group">
                        <label for="recipientBloodType">Blood Type</label>
                        <select id="recipientBloodType" required>
                            <option value="">Select Blood Type</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="recipientPhone">Phone Number</label>
                        <input type="tel" id="recipientPhone" required>
                    </div>
                    <div class="form-group">
                        <label for="recipientHospital">Hospital</label>
                        <input type="text" id="recipientHospital" required>
                    </div>
                    <div class="form-group">
                        <label for="recipientUnits">Units Required</label>
                        <input type="number" id="recipientUnits" min="1" max="10" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="recipientUrgency">Urgency Level</label>
                    <select id="recipientUrgency" required>
                        <option value="">Select Urgency</option>
                        <option value="Low">Low</option>
                        <option value="Medium">Medium</option>
                        <option value="High">High</option>
                        <option value="Critical">Critical</option>
                    </select>
                </div>
                <button type="submit" class="btn">Register Recipient</button>
            </form>
            <div id="recipientsList" class="cards-container">
                <!-- Recipients will be populated here -->
            </div>
        </div>

        <div id="inventory" class="tab-content">
            <h2>Blood Inventory</h2>
            <div id="inventoryAlert"></div>
            <form id="inventoryForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="inventoryBloodType">Blood Type</label>
                        <select id="inventoryBloodType" required>
                            <option value="">Select Blood Type</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="inventoryUnits">Units</label>
                        <input type="number" id="inventoryUnits" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="inventoryExpiryDate">Expiry Date</label>
                        <input type="date" id="inventoryExpiryDate" required>
                    </div>
                </div>
                <button type="submit" class="btn">Add to Inventory</button>
            </form>
            <div id="inventoryList" class="cards-container">
                <!-- Inventory will be populated here -->
            </div>
        </div>

        <div id="requests" class="tab-content">
            <h2>Blood Requests</h2>
            <div id="requestsAlert"></div>
            <div id="requestsList" class="cards-container">
                <!-- Requests will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // API Base URL
        const API_BASE = 'http://localhost:3000/api';

        // Tab Management
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const navTabs = document.querySelectorAll('.nav-tab');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            navTabs.forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Load data for active tab
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'donors':
                    loadDonors();
                    break;
                case 'recipients':
                    loadRecipients();
                    break;
                case 'inventory':
                    loadInventory();
                    break;
                case 'requests':
                    loadRequests();
                    break;
            }
        }

        // Utility Functions
        function showAlert(containerId, message, type = 'success') {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="alert ${type}">${message}</div>`;
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString();
        }

        // API Functions
        async function apiRequest(endpoint, method = 'GET', data = null) {
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };
            
            if (data) {
                options.body = JSON.stringify(data);
            }
            
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, options);
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'API request failed');
                }
                
                return result;
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        // Dashboard Functions
        // Dashboard Functions - FIXED VERSION
async function loadDashboard() {
    try {
        // Use the stats endpoint from your backend
        const statsResponse = await apiRequest('/stats');
        const stats = statsResponse.data;
        
        // Update dashboard stats
        document.getElementById('totalDonors').textContent = stats.totalDonors;
        document.getElementById('totalRecipients').textContent = stats.totalRecipients;
        document.getElementById('totalUnits').textContent = stats.totalUnits;
        document.getElementById('pendingRequests').textContent = stats.pendingRequests;
        
        // Load inventory for blood type stats
        const inventory = await apiRequest('/inventory');
        displayBloodTypeStats(inventory);
        
    } catch (error) {
        console.error('Failed to load dashboard:', error);
        
        // Fallback: try to load individual endpoints if stats endpoint fails
        try {
            const [donors, recipients, inventory, requests] = await Promise.all([
                apiRequest('/donors'),
                apiRequest('/recipients'),
                apiRequest('/inventory'),
                apiRequest('/requests')
            ]);
            
            document.getElementById('totalDonors').textContent = donors.length;
            document.getElementById('totalRecipients').textContent = recipients.length;
            document.getElementById('totalUnits').textContent = inventory.reduce((sum, item) => sum + item.units, 0);
            document.getElementById('pendingRequests').textContent = requests.filter(r => r.status === 'pending').length;
            
            displayBloodTypeStats(inventory);
        } catch (fallbackError) {
            console.error('Failed to load dashboard with fallback:', fallbackError);
        }
    }
}

        function displayBloodTypeStats(inventory) {
            const bloodTypes = ['A+', 'A-', 'B+', 'B-', 'AB+', 'AB-', 'O+', 'O-'];
            const stats = {};
            
            bloodTypes.forEach(type => {
                stats[type] = inventory.filter(item => item.bloodType === type).reduce((sum, item) => sum + item.units, 0);
            });
            
            const container = document.getElementById('bloodTypeStats');
            container.innerHTML = bloodTypes.map(type => `
                <div class="card">
                    <div class="blood-type">${type}</div>
                    <h3>${stats[type]} Units</h3>
                    <div class="status ${stats[type] > 10 ? 'available' : stats[type] > 5 ? 'critical' : 'out-of-stock'}">
                        ${stats[type] > 10 ? 'Available' : stats[type] > 5 ? 'Critical' : 'Out of Stock'}
                    </div>
                </div>
            `).join('');
        }

        // Donor Functions
        async function loadDonors() {
            try {
                const donors = await apiRequest('/donors');
                displayDonors(donors);
            } catch (error) {
                console.error('Failed to load donors:', error);
            }
        }

        function displayDonors(donors) {
            const container = document.getElementById('donorsList');
            container.innerHTML = donors.map(donor => `
                <div class="card">
                    <h3>${donor.name}</h3>
                    <div class="blood-type">${donor.bloodType}</div>
                    <p><strong>Age:</strong> ${donor.age}</p>
                    <p><strong>Phone:</strong> ${donor.phone}</p>
                    <p><strong>Email:</strong> ${donor.email}</p>
                    <p><strong>Address:</strong> ${donor.address}</p>
                    <p><strong>Registered:</strong> ${formatDate(donor.createdAt)}</p>
                </div>
            `).join('');
        }

        // Recipient Functions
        async function loadRecipients() {
            try {
                const recipients = await apiRequest('/recipients');
                displayRecipients(recipients);
            } catch (error) {
                console.error('Failed to load recipients:', error);
            }
        }

        function displayRecipients(recipients) {
            const container = document.getElementById('recipientsList');
            container.innerHTML = recipients.map(recipient => `
                <div class="card">
                    <h3>${recipient.name}</h3>
                    <div class="blood-type">${recipient.bloodType}</div>
                    <p><strong>Age:</strong> ${recipient.age}</p>
                    <p><strong>Phone:</strong> ${recipient.phone}</p>
                    <p><strong>Hospital:</strong> ${recipient.hospital}</p>
                    <p><strong>Units Required:</strong> ${recipient.unitsRequired}</p>
                    <p><strong>Urgency:</strong> ${recipient.urgency}</p>
                    <p><strong>Registered:</strong> ${formatDate(recipient.createdAt)}</p>
                </div>
            `).join('');
        }

        // Inventory Functions
        async function loadInventory() {
            try {
                const inventory = await apiRequest('/inventory');
                displayInventory(inventory);
            } catch (error) {
                console.error('Failed to load inventory:', error);
            }
        }

        function displayInventory(inventory) {
            const container = document.getElementById('inventoryList');
            container.innerHTML = inventory.map(item => `
                <div class="card">
                    <h3>Blood Type: ${item.bloodType}</h3>
                    <p><strong>Units:</strong> ${item.units}</p>
                    <p><strong>Expiry Date:</strong> ${formatDate(item.expiryDate)}</p>
                    <p><strong>Added:</strong> ${formatDate(item.createdAt)}</p>
                </div>
            `).join('');
        }

        // Request Functions
        async function loadRequests() {
            try {
                const requests = await apiRequest('/requests');
                displayRequests(requests);
            } catch (error) {
                console.error('Failed to load requests:', error);
            }
        }

function displayRequests(requests) {
    const container = document.getElementById('requestsList');
    container.innerHTML = requests.map(request => `
        <div class="card">
            <h3>${request.recipientName}</h3>
            <div class="blood-type">${request.bloodType}</div>
            <p><strong>Units:</strong> ${request.units}</p>
            <p><strong>Hospital:</strong> ${request.hospital}</p>
            <p><strong>Urgency:</strong> ${request.urgency}</p>
            <p><strong>Status:</strong> ${request.status}</p>
            <p><strong>Requested:</strong> ${formatDate(request.createdAt)}</p>
            ${request.status === 'pending' && request.processedBy !== 'Auto Processor' ? `
                <button class="btn" onclick="approveRequest('${request._id}')">Approve</button>
                <button class="btn btn-secondary" onclick="rejectRequest('${request._id}')">Reject</button>
            ` : ''}
        </div>
    `).join('');
}

        async function approveRequest(requestId) {
            try {
                await apiRequest(`/requests/${requestId}/approve`, 'PUT');
                showAlert('requestsAlert', 'Request approved successfully!');
                loadRequests();
                loadDashboard();
            } catch (error) {
                showAlert('requestsAlert', error.message, 'error');
            }
        }

        async function rejectRequest(requestId) {
            try {
                await apiRequest(`/requests/${requestId}/reject`, 'PUT');
                showAlert('requestsAlert', 'Request rejected successfully!');
                loadRequests();
                loadDashboard();
            } catch (error) {
                showAlert('requestsAlert', error.message, 'error');
            }
        }

        // Form Handlers
        // Donor Form Handler
document.getElementById('donorForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = {
        name: document.getElementById('donorName').value.trim(),
        age: parseInt(document.getElementById('donorAge').value),
        bloodType: document.getElementById('donorBloodType').value,
        phone: document.getElementById('donorPhone').value.trim(),
        email: document.getElementById('donorEmail').value.trim().toLowerCase(),
        address: document.getElementById('donorAddress').value.trim()
    };
    
    // Client-side validation before sending
    const errors = [];
    
    if (formData.name.length < 2 || formData.name.length > 100) {
        errors.push('Name must be between 2 and 100 characters');
    }
    
    if (formData.age < 18 || formData.age > 65) {
        errors.push('Age must be between 18 and 65');
    }
    
    const bloodTypes = ['A+', 'A-', 'B+', 'B-', 'AB+', 'AB-', 'O+', 'O-'];
    if (!bloodTypes.includes(formData.bloodType)) {
        errors.push('Please select a valid blood type');
    }
    
    if (formData.phone.length < 10 || formData.phone.length > 15) {
        errors.push('Phone number must be between 10 and 15 characters');
    }
    
    // Basic email validation
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(formData.email)) {
        errors.push('Please enter a valid email address');
    }
    
    if (formData.address.length < 10 || formData.address.length > 200) {
        errors.push('Address must be between 10 and 200 characters');
    }
    
    if (errors.length > 0) {
        showAlert('donorAlert', 'Validation errors: ' + errors.join(', '), 'error');
        return;
    }
    
    try {
        console.log('Sending donor data:', formData); // Debug log
        const response = await apiRequest('/donors', 'POST', formData);
        console.log('Response:', response); // Debug log
        
        showAlert('donorAlert', 'Donor registered successfully!');
        e.target.reset();
        loadDonors();
        loadDashboard();
    } catch (error) {
        console.error('Error details:', error); // Debug log
        
        // Enhanced error handling
        if (error.message && error.message.includes('validation')) {
            showAlert('donorAlert', `Validation failed. Please check all fields and try again. Error: ${error.message}`, 'error');
        } else if (error.message && error.message.includes('email already exists')) {
            showAlert('donorAlert', 'A donor with this email address already exists.', 'error');
        } else {
            showAlert('donorAlert', `Failed to register donor: ${error.message}`, 'error');
        }
    }
});

// Enhanced API Request Function with Better Error Handling
async function apiRequest(endpoint, method = 'GET', data = null) {
    const options = {
        method,
        headers: {
            'Content-Type': 'application/json',
        }
    };
    
    if (data) {
        options.body = JSON.stringify(data);
    }
    
    try {
        const response = await fetch(`${API_BASE}${endpoint}`, options);
        const result = await response.json();
        
        console.log('API Response Status:', response.status); // Debug log
        console.log('API Response Body:', result); // Debug log
        
        if (!response.ok) {
            // Handle validation errors specifically
            if (result.details && Array.isArray(result.details)) {
                const validationErrors = result.details.map(detail => detail.msg).join(', ');
                throw new Error(`Validation failed: ${validationErrors}`);
            }
            throw new Error(result.error || `HTTP ${response.status}: Request failed`);
        }
        
        return result;
    } catch (error) {
        console.error('API Error:', error);
        throw error;
    }
}

        document.getElementById('recipientForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('recipientName').value,
                age: parseInt(document.getElementById('recipientAge').value),
                bloodType: document.getElementById('recipientBloodType').value,
                phone: document.getElementById('recipientPhone').value,
                hospital: document.getElementById('recipientHospital').value,
                unitsRequired: parseInt(document.getElementById('recipientUnits').value),
                urgency: document.getElementById('recipientUrgency').value
            };
            
            try {
                await apiRequest('/recipients', 'POST', formData);
                showAlert('recipientAlert', 'Recipient registered successfully!');
                e.target.reset();
                loadRecipients();
                loadDashboard();
            } catch (error) {
                showAlert('recipientAlert', error.message, 'error');
            }
        });

        document.getElementById('inventoryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                bloodType: document.getElementById('inventoryBloodType').value,
                units: parseInt(document.getElementById('inventoryUnits').value),
                expiryDate: document.getElementById('inventoryExpiryDate').value
            };
            
            try {
                await apiRequest('/inventory', 'POST', formData);
                showAlert('inventoryAlert', 'Blood units added to inventory successfully!');
                e.target.reset();
                loadInventory();
                loadDashboard();
            } catch (error) {
                showAlert('inventoryAlert', error.message, 'error');
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadDashboard();
        });
    </script>
</body>
</html>
